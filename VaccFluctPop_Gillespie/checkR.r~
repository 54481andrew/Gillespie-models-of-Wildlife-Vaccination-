datname = 'ConstBirth'
dat = read.table(file = datname, header = T, sep = " ")
names(dat)

require(deSolve)
source('Tools/Functions.r', local = TRUE)

parms = data.frame(b0 = 200, tb = 365, tv = 50, d = 0.004, Tb = 365, Bp = 0.000005, gamp = 0.005, gamv = 0.07, NVacc = 5000)
times = seq(0,10000)
y0 = c(1000, 0, 100, 0, 00)
names(y0) = c('S','Iv','Ip','V','P')

maxtimes <- 365*10
timeseq  <- seq(0,maxtimes, by = 0.01)

VaccPer        <- 365
NVacc          <- parms$NVacc

tv <- parms$tv
vacctimes <- seq(tv, maxtimes,by = VaccPer)

out <- data.frame(lsoda(y = y0, times = times, 
                   func = rhs.fun, parms = parms,
                   events=list(func = vaccinate, time=vacctimes),
                   maxsteps = 100000))



pdf(file = paste(datname, ".pdf",sep = ""))
plot(S~time, out, xlim = c(0,365*5), ylim = c(0,30000), type = 'l', lwd = 4)
lines(Iv~time, out, col = 'green', lty = 2, lwd = 4)
lines(Ip~time, out, col = 'red', lty = 2, lwd = 4)
lines(V~time, out, col = 'blue', lty = 2, lwd = 4)
lines(P~time, out, col = 'pink', lty = 2, lwd = 4)

these <- seq(1,nrow(dat), by = 25)
points(S~time, dat[these,], col = 'black', cex = 1)
points(Iv~time, dat[these,], col = 'green', cex = 1)
points(Ip~time, dat[these,], col = 'red', cex = 1)
points(V~time, dat[these,], col = 'blue', cex = 1)
points(P~time, dat[these,], col = 'pink', cex = 1)

dev.off()





